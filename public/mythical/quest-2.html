<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spells of Personality - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "tk53e05gf2");
    </script>
    
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }

        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/RealtimeAIApp-JS" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Kingdom of Realtime AI</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Adventure</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Spells of Personality</h1>
<hr>
<p>In the heart of the Enchanted Castle, the Oracle‚Äôs wisdom manifests through spells that shape the AI‚Äôs personality. These magical incantations, stored in ancient scrolls, are crafted to guide knights and healers in their quests. As an adventurer, your task is to uncover the essence of these spells, learning how they define the AI‚Äôs behavior and its interactions with the mythical realms of Language Coaching and Medical Assistance. The scrolls reveal the secrets of structured messages and enchanted tools that bring these personalities to life.</p>
<h2>Key Takeaways</h2>
<p>After completing this quest, you will understand:</p>
<ul>
<li>üéØ <strong>System Message Configuration</strong>: How AI personalities are defined using structured messages and initial instructions.</li>
<li>üîç <strong>JSON Schema Integration</strong>: How schemas ensure structured data handling for medical forms and language practice.</li>
<li>‚ö° <strong>Tool Invocation</strong>: How function calls are embedded within system messages to execute specific tasks.</li>
<li>üí° <strong>Dynamic Personality Switching</strong>: How different AI personalities are activated based on user requests.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/RealtimeAIApp-JS/blob/main/server/src/systemMessages.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">server/src/systemMessages.ts</code></a></h3>
<p>The scroll of <code class="inline-code">systemMessages.ts</code> contains the enchanted scripts that define the Oracle‚Äôs personalities. Each personality is represented as a <code class="inline-code">SystemMessage</code> object, detailing its type, initial instructions, and magical tools (functions) it can invoke. The file showcases how the AI adapts to different contexts, such as language coaching or medical assistance, by switching its behavior based on predefined rules and schemas.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">systemMessages</code>: Defines a collection of AI personalities, including their instructions and tools.</li>
<li><a href="https://github.com/danwahlin/RealtimeAIApp-JS/blob/main/server/src/systemMessages.ts#L90" target="_blank" rel="noopener noreferrer"><code class="inline-code">getSystemMessage</code></a>: Retrieves the appropriate personality based on the requested type.</li>
<li><a href="https://github.com/danwahlin/RealtimeAIApp-JS/blob/main/server/src/systemMessages.ts#L95" target="_blank" rel="noopener noreferrer"><code class="inline-code">getMedicalJSONSchema</code></a>: Provides the schema for structured medical data handling.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">const systemMessages: SystemMessage[] = [
    {
        type: &#39;language-coach&#39;,
        initialInstructions: `Greet the user warmly and ask what language they&#39;d like to learn today. Keep it very brief and friendly.`,
        message: `You are a helpful language coach that is capable of teaching students different phrases in their chosen language. You will 
            provide sentences in English, followed by the same sentence in the user&#39;s chosen language.

            RULES:
            - After the student tells you their chosen language, you will then read sentences in
            English followed by reading the same sentence in the user&#39;s chosen language. 
            - Provide a pronunciation guide for the sentence in the user&#39;s chosen language. Place it in parentheses after the language sentence.
            - Surround the English sentence and the language sentence with {{ and }}. Example:

            {{ English: Hello, how are you? }} {{ Spanish: Hola, ¬øc√≥mo est√°s? (oh-lah koh-moh ehs-tahs) }}

            - After you provide the English and language phrases, wait for the user to repeat it back to you. 
              DO NOT SAY &quot;Now you try it&quot; or &quot;Repeat after me&quot;. Stop speaking after you say the language phrase.
            - The user will then repeat the sentence to you in their chosen language where you&#39;ll analyze 
            how well they did with pronunciation, and let them know. If their pronunciation isn&#39;t good, have them repeat the same sentence
            and analyze it again.
            - Always invoke the function call output tooling (get_language_phrases function) with the updated JSON object that matches the defined function call parameters.
        `,
        tools: []
    },
    {
        type: &#39;medical-form&#39;,
        initialInstructions: `Greet the medical personnel warmly and ask them to provide their patient information. Keep it very brief - 1 sentence only.`,
        message: `You are helping to edit a JSON object we&#39;ll refer to as &quot;patientData&quot; that represents a medical patient&#39;s personal information, symptoms, and vitals.
            This JSON object conforms to the following schema: 

            ${getMedicalJSONSchema()}

            RULES:
            - If the user says &quot;patient&quot;, return a value of &quot;patient&quot; for the &quot;tab&quot; property.
            - If the user says &quot;symptom&quot;, &quot;symptoms&quot;, or &quot;add symptom&quot;, return a value of &quot;symptoms&quot; for the &quot;tab&quot; property.
            - If the user says &quot;vitals&quot;, return a value of &quot;vitals&quot; for the &quot;tab&quot; property.
            - If the users gives the age in months, return &quot;[number] months&quot; for the &quot;age&quot; property.
            - If the user asks says &quot;new symptom&quot; or &quot;add new symptom&quot;, add a new array item to the &quot;symptoms&quot; array and wait for them to provide the information. 
              Do not ask them what to provide for the symptom, only add a new symptom object into the &quot;symptoms&quot; array and wait for them to provide the information.
            - Always invoke the function call output tooling (get_json_object function) with the updated JSON object that matches the defined function call parameters.
        `,
        tools: [{
            type: &#39;function&#39;,
            name: &#39;get_json_object&#39;,
            description: &#39;Converts text into a JSON object based upon a JSON schema&#39;,
            parameters: getMedicalJSONSchema()
        }]
    }
];
</code></pre>
<ul>
<li>Defines the AI‚Äôs personalities, including their rules and behaviors for specific tasks.</li>
<li>Provides structured instructions to ensure consistent interaction patterns.</li>
<li>Embeds tools (functions) for dynamic functionality, such as JSON object handling.</li>
<li>Highlights the importance of schema validation for structured data processing.</li>
<li>Demonstrates how initial instructions set the tone for user interactions.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function getSystemMessage(type: string): SystemMessage | null {
    const systemMessage = systemMessages.find((systemMessage) =&gt; systemMessage.type === type);
    return systemMessage || null;
}
</code></pre>
<ul>
<li>Retrieves the AI personality based on the specified type, enabling dynamic behavior switching.</li>
<li>Uses array search to match the requested personality type.</li>
<li>Ensures flexibility in adapting to different user needs by providing tailored responses.</li>
<li>Demonstrates modular design, allowing easy addition of new personalities.</li>
<li>Highlights the importance of type safety and validation in personality selection.</li>
</ul>
<hr>
<pre><code class="language-typescript">function getMedicalJSONSchema() {
    return {
        type: &#39;object&#39;,
        properties: {
            tab: { type: &#39;string&#39;, enum: [&#39;patient&#39;, &#39;symptoms&#39;, &#39;vitals&#39;] },
            information: {
                type: &#39;object&#39;,
                properties: {
                    name: { type: &#39;string&#39; },
                    age: { type: &#39;string&#39; },
                    gender: { type: &#39;string&#39;, enum: [&#39;male&#39;, &#39;female&#39;] },
                    historyPastMedical: { type: &#39;string&#39; },
                    historyOfPresentIllness: { type: &#39;string&#39; }
                },
                required: [&#39;name&#39;, &#39;age&#39;, &#39;gender&#39;]
            },
            symptoms: {
                type: &#39;array&#39;, items:
                {
                    type: &#39;object&#39;, properties: { id: { type: &#39;number&#39; }, description: { type: &#39;string&#39; }, duration: { type: &#39;string&#39; }, severity: { type: &#39;number&#39; }, notes: { type: &#39;string&#39; } },
                    required: [&#39;id&#39;, &#39;description&#39;, &#39;duration&#39;, &#39;severity&#39;]
                }
            },
            vitals: { type: &#39;object&#39;, properties: { temperature: { type: &#39;number&#39; }, bloodPressure: { type: &#39;string&#39; }, heartRate: { type: &#39;number&#39; } }, required: [&#39;temperature&#39;, &#39;bloodPressure&#39;, &#39;heartRate&#39;] },
        },
        required: [&#39;tab&#39;, &#39;information&#39;, &#39;symptoms&#39;, &#39;vitals&#39;],
    }
}
</code></pre>
<ul>
<li>Defines the JSON schema for structured medical data handling.</li>
<li>Ensures consistency and validation of user-provided information.</li>
<li>Highlights the importance of required fields for critical data collection.</li>
<li>Demonstrates how schemas enforce data integrity and prevent errors.</li>
<li>Provides a clear template for organizing complex data structures.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/RealtimeAIApp-JS/blob/main/server/src/types.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">server/src/types.ts</code></a></h3>
<p>The scroll of <code class="inline-code">types.ts</code> contains the mystical definitions that shape the communication between knights and the Oracle. These TypeScript types ensure that messages, tools, and metrics are accurately described, enabling seamless interactions and precise data handling.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">WSMessage</code>: Defines the structure of WebSocket messages.</li>
<li><code class="inline-code">SystemMessage</code>: Represents the configuration for AI personalities.</li>
<li><code class="inline-code">AudioMetrics</code>: Tracks audio performance data for sessions.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export type WSMessage =
    | { id: string; type: &#39;text_delta&#39;; delta: string }
    | { id?: string; type: &#39;transcription&#39;; text: string }
    | { id: string; type: &#39;user_message&#39;; text: string }
    | { type: &#39;control&#39;; action: &#39;speech_started&#39; | &#39;connected&#39; | &#39;text_done&#39; | &#39;function_call_output&#39;; functionCallParams?: string; id?: string }
    | { type: &#39;control&#39;; action: &#39;session_created&#39;; id?: string }
    | { type: &#39;control&#39;; action: &#39;error&#39;; error: OpenAIError; id?: string }
    | { type: &#39;control&#39;; action: &#39;rate_limits_updated&#39;; rateLimits: RateLimits; id?: string };
</code></pre>
<ul>
<li>Defines the structure of WebSocket messages for seamless communication.</li>
<li>Ensures type safety and consistency across message handling.</li>
<li>Highlights the importance of clear message types for debugging and development.</li>
<li>Provides flexibility for various message actions, such as speech detection and function calls.</li>
<li>Demonstrates the use of union types for diverse message formats.</li>
</ul>
<hr>
<pre><code class="language-typescript">export type SystemMessage = {
    type: &#39;language-coach&#39; | &#39;medical-form&#39; | &#39;medical-question-answer&#39;;
    initialInstructions: string;
    message: string;
    tools?: SystemMessageTool[];
}
</code></pre>
<ul>
<li>Represents the configuration for AI personalities, including instructions and tools.</li>
<li>Enables dynamic personality switching based on user needs.</li>
<li>Demonstrates modular design for easy expansion of personality types.</li>
<li>Highlights the importance of structured definitions for consistent behavior.</li>
<li>Ensures compatibility with system messages in <code class="inline-code">systemMessages.ts</code>.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Study how <code class="inline-code">systemMessages.ts</code> defines AI personalities and their tools for specific tasks.</li>
<li>Explore the use of schemas in <a href="https://github.com/danwahlin/RealtimeAIApp-JS/blob/main/server/src/systemMessages.ts#L95" target="_blank" rel="noopener noreferrer"><code class="inline-code">getMedicalJSONSchema</code></a> to validate and structure user-provided data.</li>
<li>Notice how <code class="inline-code">types.ts</code> ensures type safety and consistency across WebSocket communication.</li>
</ul>
<h2>Try This</h2>
<p>Challenge yourself to deepen your understanding:</p>
<ol>
<li><strong>Add a New Personality</strong>: Create a new AI personality in <code class="inline-code">systemMessages.ts</code> for a &quot;Travel Guide&quot; that provides tips and recommendations for different destinations. Define its initial instructions and tools, then test its integration.</li>
<li><strong>Trace Personality Switching</strong>: Add console.log statements in <a href="https://github.com/danwahlin/RealtimeAIApp-JS/blob/main/server/src/systemMessages.ts#L90" target="_blank" rel="noopener noreferrer"><code class="inline-code">getSystemMessage</code></a> to observe how different personalities are activated based on user requests. Test with &quot;language-coach&quot; and &quot;medical-form&quot; types.</li>
</ol>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the Enchanted Castle&#39;s magical systems.</p>
<p>Hail, brave scholar, for you have unlocked the enchanted tome of &quot;Spells of Personality,&quot; weaving the first strand of your heroic tapestry‚Äîmay your wisdom shine brighter than the celestial ‚≠ê and your journey blaze with the fury of ‚ö°!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>